name: CI

on:
  pull_request:
    branches: [main]

env:
  NEXT_PUBLIC_SITE_URL: https://your-domain.vercel.app
  NEXT_PUBLIC_GISCUS_REPO: twofoldtech-dakota/my-site
  NEXT_PUBLIC_GISCUS_REPO_ID: R_kgDONxWbPw
  NEXT_PUBLIC_GISCUS_CATEGORY: General
  NEXT_PUBLIC_GISCUS_CATEGORY_ID: DIC_kwDONxWbP84Cmgsy

jobs:
  typecheck:
    name: TypeScript Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
      - run: npm ci
      - run: npx tsc --noEmit

  lint:
    name: ESLint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
      - run: npm ci
      - run: npx eslint .

  build:
    name: Build Verification
    needs: [typecheck, lint]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
      - run: npm ci
      - uses: actions/cache@v4
        with:
          path: .next/cache
          key: nextjs-${{ hashFiles('package-lock.json') }}-${{ hashFiles('**/*.ts', '**/*.tsx') }}
          restore-keys: nextjs-${{ hashFiles('package-lock.json') }}-
      - run: npm run build
